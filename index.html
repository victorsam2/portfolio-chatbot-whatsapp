<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot WhatsApp com IA - Pity Rodas | DocumentaÃ§Ã£o TÃ©cnica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        header .meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
            font-size: 0.95em;
        }

        header .meta-item {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        nav {
            background: #2d3748;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        nav ul li a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            transition: background 0.3s;
        }

        nav ul li a:hover {
            background: #4a5568;
        }

        .content {
            padding: 40px;
        }

        section {
            margin-bottom: 50px;
            scroll-margin-top: 60px;
        }

        h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #4a5568;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: #2d3748;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .highlight-box {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .highlight-box.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .highlight-box.warning {
            border-left-color: #ed8936;
            background: #fffaf0;
        }

        .highlight-box.info {
            border-left-color: #4299e1;
            background: #ebf8ff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        table tr:nth-child(even) {
            background: #f7fafc;
        }

        table tr:hover {
            background: #edf2f7;
        }

        .architecture-diagram {
            background: #2d3748;
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .architecture-diagram pre {
            color: #e2e8f0;
            line-height: 1.8;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .feature-card h4 {
            color: #667eea;
            margin-top: 0;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        code {
            background: #2d3748;
            color: #68d391;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }

        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .badge.tech {
            background: #667eea;
            color: white;
        }

        .badge.priority-high {
            background: #f56565;
            color: white;
        }

        .badge.priority-medium {
            background: #ed8936;
            color: white;
        }

        .badge.priority-low {
            background: #48bb78;
            color: white;
        }

        footer {
            background: #2d3748;
            color: white;
            text-align: center;
            padding: 30px;
            margin-top: 50px;
        }

        .toc {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .toc h3 {
            margin-top: 0;
        }

        .toc ul {
            list-style: none;
            padding-left: 20px;
        }

        .toc ul li {
            margin: 8px 0;
        }

        .toc ul li a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s;
        }

        .toc ul li a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
            nav {
                display: none;
            }
            section {
                page-break-inside: avoid;
            }
        }

        .nav-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 12px 20px;
            width: 100%;
            text-align: left;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            header {
                padding: 40px 20px;
            }
            header h1 {
                font-size: 1.6em;
            }
            header .subtitle {
                font-size: 1em;
            }
            header .meta {
                flex-direction: column;
                gap: 8px;
            }
            header .meta-item {
                font-size: 0.85em;
            }
            .nav-toggle {
                display: block;
            }
            nav ul {
                display: none;
                flex-direction: column;
            }
            nav ul.open {
                display: flex;
            }
            nav ul li a {
                padding: 12px 20px;
                border-top: 1px solid #4a5568;
            }
            nav {
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .stat-grid, .feature-grid {
                grid-template-columns: 1fr;
            }
            h2 {
                font-size: 1.5em;
            }
            h3 {
                font-size: 1.2em;
            }
            .architecture-diagram {
                padding: 15px;
                font-size: 0.65em;
            }
            pre {
                padding: 15px;
                font-size: 0.85em;
            }
            table {
                font-size: 0.85em;
            }
            table th, table td {
                padding: 8px;
            }
            .stat-card .number {
                font-size: 2em;
            }
        }

        .workflow-stats {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .workflow-stats h3 {
            color: white;
            margin-top: 0;
        }

        ul.checklist {
            list-style: none;
            padding-left: 0;
        }

        ul.checklist li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }

        ul.checklist li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¤– Chatbot WhatsApp com IA</h1>
            <div class="subtitle">Sistema de Atendimento Automatizado para Pity Rodas</div>
            <div class="meta">
                <div class="meta-item">ğŸ“… Implementado: Fevereiro 2026</div>
                <div class="meta-item">âš¡ Status: Em ProduÃ§Ã£o</div>
                <div class="meta-item">ğŸ¢ Cliente: Pity Rodas - Ipatinga/MG</div>
                <div class="meta-item">ğŸ‘¨â€ğŸ’» Desenvolvedor: Victor Sam</div>
            </div>
        </header>

        <nav>
            <button class="nav-toggle" onclick="document.querySelector('nav ul').classList.toggle('open'); this.textContent = this.textContent === 'â˜° Menu' ? 'âœ• Fechar' : 'â˜° Menu'">â˜° Menu</button>
            <ul>
                <li><a href="#visao-geral" onclick="document.querySelector('nav ul').classList.remove('open'); document.querySelector('.nav-toggle').textContent='â˜° Menu'">VisÃ£o Geral</a></li>
                <li><a href="#arquitetura" onclick="document.querySelector('nav ul').classList.remove('open'); document.querySelector('.nav-toggle').textContent='â˜° Menu'">Arquitetura</a></li>
                <li><a href="#funcionalidades" onclick="document.querySelector('nav ul').classList.remove('open'); document.querySelector('.nav-toggle').textContent='â˜° Menu'">Funcionalidades</a></li>
                <li><a href="#metricas" onclick="document.querySelector('nav ul').classList.remove('open'); document.querySelector('.nav-toggle').textContent='â˜° Menu'">MÃ©tricas</a></li>
                <li><a href="#tecnico" onclick="document.querySelector('nav ul').classList.remove('open'); document.querySelector('.nav-toggle').textContent='â˜° Menu'">Detalhes TÃ©cnicos</a></li>
                <li><a href="#impacto" onclick="document.querySelector('nav ul').classList.remove('open'); document.querySelector('.nav-toggle').textContent='â˜° Menu'">Impacto</a></li>
            </ul>
        </nav>

        <div class="content">
            <section id="visao-geral">
                <h2>ğŸ“‹ VisÃ£o Geral do Projeto</h2>

                <p>Sistema de atendimento automatizado via WhatsApp desenvolvido para a <strong>Pity Rodas</strong>, tradicional empresa do setor automotivo em Ipatinga-MG. O chatbot utiliza inteligÃªncia artificial (Google Gemini 2.0) para realizar atendimento inicial 24/7, coletar dados estruturados de clientes e transferir leads qualificados para a equipe de vendas.</p>

                <div class="highlight-box success">
                    <h4>ğŸ¯ Objetivo Principal</h4>
                    <p>Reduzir o tempo de primeira resposta de <strong>96 minutos para 35 segundos</strong> (reduÃ§Ã£o de 99,4%), garantindo atendimento imediato em qualquer horÃ¡rio e dia da semana, enquanto coleta todas as informaÃ§Ãµes necessÃ¡rias para que o vendedor humano foque exclusivamente em negociaÃ§Ã£o e fechamento.</p>
                </div>

                <h3>Problema Identificado</h3>
                <p>AnÃ¡lise de dados reais de produÃ§Ã£o revelou que:</p>
                <ul class="checklist">
                    <li>Tempo mediano de primeira resposta: <strong>96 minutos</strong></li>
                    <li>66% dos clientes esperavam mais de 1 hora para qualquer retorno</li>
                    <li>Leads fora do horÃ¡rio comercial eram completamente perdidos</li>
                    <li>Coleta de dados era inconsistente e dependente do atendente</li>
                    <li>Vendedores gastavam tempo com triagem ao invÃ©s de negociaÃ§Ã£o</li>
                </ul>

                <h3>SoluÃ§Ã£o Implementada</h3>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="number">35s</div>
                        <div class="label">Tempo de Resposta</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">24/7</div>
                        <div class="label">Disponibilidade</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">99.4%</div>
                        <div class="label">ReduÃ§Ã£o de Tempo</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">100%</div>
                        <div class="label">Leads Qualificados</div>
                    </div>
                </div>
            </section>

            <section id="arquitetura">
                <h2>ğŸ—ï¸ Arquitetura do Sistema</h2>

                <h3>Stack TecnolÃ³gico</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ”„ n8n (Workflow Automation)</h4>
                        <p>Plataforma de automaÃ§Ã£o self-hosted que orquestra todo o fluxo de mensagens, integra APIs e gerencia a lÃ³gica de negÃ³cio.</p>
                        <span class="badge tech">Self-hosted</span>
                        <span class="badge tech">Low-code</span>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ’¬ Evolution API</h4>
                        <p>Gateway WhatsApp self-hosted para envio e recebimento de mensagens, com suporte a mÃºltiplos tipos de mÃ­dia.</p>
                        <span class="badge tech">WhatsApp Gateway</span>
                        <span class="badge tech">REST API</span>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ§  Google Gemini 2.0 Flash</h4>
                        <p>Modelo de linguagem natural para compreensÃ£o e geraÃ§Ã£o de respostas contextualizadas.</p>
                        <span class="badge tech">LLM</span>
                        <span class="badge tech">Fast & Cost-effective</span>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ™ï¸ Groq Whisper Turbo</h4>
                        <p>API de transcriÃ§Ã£o de Ã¡udio com alta precisÃ£o em portuguÃªs brasileiro.</p>
                        <span class="badge tech">Speech-to-Text</span>
                        <span class="badge tech">Multi-retry</span>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ’¾ Redis</h4>
                        <p>Armazenamento de sessÃµes, memÃ³ria de conversaÃ§Ã£o e sistema de bloqueio/deduplicaÃ§Ã£o.</p>
                        <span class="badge tech">In-memory DB</span>
                        <span class="badge tech">TTL Management</span>
                    </div>
                    <div class="feature-card">
                        <h4>â˜ï¸ EasyPanel</h4>
                        <p>Plataforma de hosting para gerenciamento de containers e infraestrutura.</p>
                        <span class="badge tech">Container Management</span>
                        <span class="badge tech">Self-hosted</span>
                    </div>
                </div>

                <h3>Fluxo de Arquitetura</h3>
                <div class="architecture-diagram">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENTE (WhatsApp)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Evolution API                                   â”‚
â”‚  â€¢ Recebe mensagens (texto, Ã¡udio, imagem)                             â”‚
â”‚  â€¢ Envia respostas para o cliente                                      â”‚
â”‚  â€¢ Gerencia presenÃ§a (online, digitando)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ Webhook
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           n8n WORKFLOW                                  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Validar ApiKey â”‚ â†’ â”‚ Extrair Dadosâ”‚ â†’ â”‚ Switch (Tipo)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                     â”‚                   â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚            â–¼                    â–¼                   â–¼          â–¼       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚   Texto    â”‚      â”‚  Ãudio   â”‚       â”‚  Imagem  â”‚  â”‚ Outros â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                      â”‚ Groq Whisper API â”‚ (TranscriÃ§Ã£o)                â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚            â–¼                                         â–¼                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚     â”‚ fromMe?     â”‚â”€â”€â”€SIMâ”€â”€â†’                 â”‚  Bloquear  â”‚           â”‚
â”‚     â”‚ (atendente) â”‚                          â”‚  IA (3h)   â”‚           â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚            â”‚ NÃƒO                                                        â”‚
â”‚            â–¼                                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   NÃƒO  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚     â”‚  Bloqueado?  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Acumular msgs (30s) â”‚                  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â”‚ SIM                        â”‚                              â”‚
â”‚            â–¼                            â–¼                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚    â”‚ Salvar na    â”‚         â”‚ Deduplicar (Redis)  â”‚                  â”‚
â”‚    â”‚ MemÃ³ria      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                              â”‚
â”‚                                        â–¼                              â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                            â”‚   AI AGENT (Gemini)    â”‚                  â”‚
â”‚                            â”‚  + Redis Chat Memory   â”‚                  â”‚
â”‚                            â”‚  (15 msgs, 24h TTL)    â”‚                  â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                        â”‚                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â–¼                                â–¼                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚         â”‚ [TRANSFER:...]   â”‚              â”‚   Resposta   â”‚           â”‚
â”‚         â”‚ detectado?       â”‚              â”‚   Normal     â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                    â”‚ SIM                          â”‚                   â”‚
â”‚                    â–¼                              â–¼                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â”‚ Processar dados  â”‚           â”‚ Enviar resposta   â”‚         â”‚
â”‚         â”‚ Verificar horÃ¡rioâ”‚           â”‚ ao cliente        â”‚         â”‚
â”‚         â”‚ Formatar mensagemâ”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                    â”‚                                                   â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚            â–¼                â–¼                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   â”‚ Notificar Grupoâ”‚  â”‚ Despedida ao â”‚                              â”‚
â”‚   â”‚ de Vendas      â”‚  â”‚ Cliente      â”‚                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   GRUPO WHATSAPP VENDAS       â”‚
                    â”‚   (Lead qualificado com       â”‚
                    â”‚    todos os dados)            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
                </div>

                <h3>Workflow Nodes (37 nodes)</h3>
                <div class="workflow-stats">
                    <h3>EstatÃ­sticas do Workflow</h3>
                    <ul>
                        <li><strong>Total de Nodes:</strong> 37</li>
                        <li><strong>Triggers:</strong> 2 (Webhook + Manual)</li>
                        <li><strong>DecisÃµes (If/Switch):</strong> 6</li>
                        <li><strong>OperaÃ§Ãµes Redis:</strong> 7</li>
                        <li><strong>IntegraÃ§Ãµes API:</strong> 6 (Evolution API, Groq, Gemini)</li>
                        <li><strong>Nodes de TransformaÃ§Ã£o:</strong> 10</li>
                        <li><strong>Tratamento de Erros:</strong> 100% (retry + fallback)</li>
                    </ul>
                </div>
            </section>

            <section id="funcionalidades">
                <h2>âš™ï¸ Funcionalidades Implementadas</h2>

                <h3>1. Processamento Multimodal de Mensagens</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Tipo de Mensagem</th>
                            <th>Tratamento</th>
                            <th>Tecnologia</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Texto</strong> (conversation)</td>
                            <td>Processado diretamente pelo AI Agent</td>
                            <td>Gemini 2.0 Flash</td>
                        </tr>
                        <tr>
                            <td><strong>Ãudio/Voz</strong> (audioMessage)</td>
                            <td>Transcrito automaticamente â†’ Processado como texto</td>
                            <td>Groq Whisper Turbo + Gemini</td>
                        </tr>
                        <tr>
                            <td><strong>VÃ­deo</strong> (videoMessage)</td>
                            <td>Ãudio extraÃ­do e transcrito</td>
                            <td>Groq Whisper (MP4 support)</td>
                        </tr>
                        <tr>
                            <td><strong>Imagem</strong> (imageMessage)</td>
                            <td>Registrado como "[foto de referÃªncia]"</td>
                            <td>Evolution API (metadata)</td>
                        </tr>
                        <tr>
                            <td><strong>Documento PDF</strong></td>
                            <td>Texto extraÃ­do (atÃ© 10 pÃ¡ginas, 2000 chars)</td>
                            <td>Extract from File (n8n)</td>
                        </tr>
                        <tr>
                            <td><strong>LocalizaÃ§Ã£o</strong></td>
                            <td>Detectado e IA pode informar endereÃ§o da loja</td>
                            <td>Fallback inteligente</td>
                        </tr>
                        <tr>
                            <td><strong>Contato/vCard</strong></td>
                            <td>Detectado e tratado sem erro</td>
                            <td>Fallback com guard</td>
                        </tr>
                        <tr>
                            <td><strong>Sticker/Reaction</strong></td>
                            <td>Ignorados silenciosamente</td>
                            <td>Switch direto (sem processamento)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>2. Sistema de QualificaÃ§Ã£o de Leads</h3>
                <p>A IA coleta <strong>dados obrigatÃ³rios</strong> antes de transferir para vendas. Sistema adaptativo por tipo de serviÃ§o:</p>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ”© Rodas Novas</h4>
                        <ul class="checklist">
                            <li>Nome do cliente</li>
                            <li>VeÃ­culo + ano</li>
                            <li>Aro desejado</li>
                            <li>Estilo/modelo</li>
                            <li>Quantidade</li>
                            <li>Foto de referÃªncia (solicita proativamente)</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸš— Pneus</h4>
                        <ul class="checklist">
                            <li>Nome do cliente</li>
                            <li>VeÃ­culo + ano</li>
                            <li>Quantidade (2 ou 4)</li>
                            <li>Medida (se souber)</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ”§ Reforma de Rodas</h4>
                        <ul class="checklist">
                            <li>Nome do cliente</li>
                            <li>Quantidade</li>
                            <li>Problema (arranhÃ£o, empeno, etc)</li>
                            <li>Foto das rodas (solicita ativamente)</li>
                            <li>Cor desejada</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>âš™ï¸ ServiÃ§os</h4>
                        <ul class="checklist">
                            <li>Nome do cliente</li>
                            <li>Tipo de serviÃ§o</li>
                            <li>Quantidade</li>
                        </ul>
                    </div>
                </div>

                <h3>3. Handoff Inteligente IA â†” Humano</h3>
                <div class="highlight-box info">
                    <h4>Sistema de Bloqueio AutomÃ¡tico (3 horas)</h4>
                    <p>Quando um atendente humano responde (<code>fromMe=true</code>), o sistema:</p>
                    <ul>
                        <li>âœ… Bloqueia IA por 3 horas (TTL 10.800s)</li>
                        <li>âœ… Renova o bloqueio a cada nova resposta humana</li>
                        <li>âœ… Salva mensagens humanas na memÃ³ria da conversa</li>
                        <li>âœ… IA retoma automaticamente apÃ³s expiraÃ§Ã£o do bloqueio</li>
                        <li>âœ… Detecta retorno do cliente e re-transfere com urgÃªncia ALTA</li>
                    </ul>
                    <p><strong>Dado de produÃ§Ã£o:</strong> 66% dos atendimentos humanos levam mais de 1h, justificando o TTL de 3h.</p>
                </div>

                <h3>4. NotificaÃ§Ã£o Estruturada ao Grupo de Vendas</h3>
                <p>Cada transferÃªncia gera uma mensagem formatada no WhatsApp com:</p>
                <pre><code>ğŸ”” *NOVO LEAD*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¤  *JosÃ© Silva*
ğŸ’¬  https://wa.me/5531999999999

ğŸš—  *VeÃ­culo:* Corolla 2022
â­•  *Pedido:* 4 rodas aro 18 esportivo
ğŸ“¦  *Quantidade:* 4
ğŸ“¸  *Foto de ref:* Sim âœ…

âš¡ ğŸŸ¡ MEDIA  Â·  ğŸ• 09/02, 14:30
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</code></pre>

                <h4>Indicadores Visuais</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Campo</th>
                            <th>DescriÃ§Ã£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Link wa.me</strong></td>
                            <td>Abre conversa com 1 clique (deep link)</td>
                        </tr>
                        <tr>
                            <td><strong>UrgÃªncia</strong></td>
                            <td>ğŸŸ¢ Baixa | ğŸŸ¡ MÃ©dia | ğŸ”´ Alta (baseado em palavras-chave)</td>
                        </tr>
                        <tr>
                            <td><strong>Foto de ref</strong></td>
                            <td>Sim âœ… | NÃ£o âŒ (importante para rodas e reformas)</td>
                        </tr>
                        <tr>
                            <td><strong>HorÃ¡rio</strong></td>
                            <td>Identifica se lead chegou fora do expediente</td>
                        </tr>
                    </tbody>
                </table>

                <h3>5. DeduplicaÃ§Ã£o e AcÃºmulo de Mensagens</h3>
                <div class="highlight-box warning">
                    <h4>â±ï¸ Sistema de Wait Adaptativo (30 segundos)</h4>
                    <p><strong>Problema:</strong> Clientes frequentemente enviam mÃºltiplas mensagens em sequÃªncia ("Oi" â†’ "Quero rodas" â†’ "Pro meu Civic 2020").</p>
                    <p><strong>SoluÃ§Ã£o:</strong> Wait de 30 segundos para acumular mensagens antes de processar.</p>
                    <p><strong>Dados de produÃ§Ã£o que embasaram a decisÃ£o:</strong></p>
                    <ul>
                        <li>62% das rajadas de mensagens cabem em 30 segundos</li>
                        <li>69% cabem em 45 segundos (ganho marginal de 7%)</li>
                        <li>Acima de 45s, o ganho nÃ£o justifica a latÃªncia extra</li>
                    </ul>
                    <p><strong>DeduplicaÃ§Ã£o via Redis:</strong> TTL de 300s para evitar processamento duplicado da mesma mensagem.</p>
                </div>

                <h3>6. MemÃ³ria de ConversaÃ§Ã£o Persistente</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ParÃ¢metro</th>
                            <th>Valor</th>
                            <th>Justificativa</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Contexto</strong></td>
                            <td>15 mensagens</td>
                            <td>Suficiente para 95% das conversas (mÃ©dia: 7,4 msgs/sessÃ£o)</td>
                        </tr>
                        <tr>
                            <td><strong>TTL</strong></td>
                            <td>24 horas</td>
                            <td>98,8% das sessÃµes terminam em menos de 2 horas</td>
                        </tr>
                        <tr>
                            <td><strong>Session ID</strong></td>
                            <td>instance + remoteJid</td>
                            <td>Isolamento por cliente</td>
                        </tr>
                        <tr>
                            <td><strong>Storage</strong></td>
                            <td>Redis (in-memory)</td>
                            <td>Acesso rÃ¡pido (<1ms)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>7. Tratamento de HorÃ¡rio Comercial</h3>
                <ul class="checklist">
                    <li>DetecÃ§Ã£o automÃ¡tica de fuso horÃ¡rio (SÃ£o Paulo/BRT)</li>
                    <li>HorÃ¡rio configurado: Seg-Sex 8h-18h | SÃ¡b 8h-12h</li>
                    <li>Leads fora do horÃ¡rio identificados com marcador visual</li>
                    <li>Aviso automÃ¡tico ao cliente sobre retorno da equipe</li>
                    <li><strong>IA nunca promete tempo de retorno</strong> (sistema adiciona aviso)</li>
                </ul>

                <h3>8. TranscriÃ§Ã£o de Ãudio com Retry</h3>
                <div class="highlight-box">
                    <h4>ConfiguraÃ§Ã£o de ResiliÃªncia</h4>
                    <ul>
                        <li><strong>Modelo:</strong> Groq Whisper Large v3 Turbo</li>
                        <li><strong>Idioma:</strong> PortuguÃªs (pt) fixo</li>
                        <li><strong>Retry:</strong> 5 tentativas com wait de 5s entre cada</li>
                        <li><strong>Timeout:</strong> 30s por tentativa</li>
                        <li><strong>Fallback:</strong> Se falha, pede ao cliente enviar por texto</li>
                    </ul>
                    <p><strong>Taxa de sucesso em produÃ§Ã£o:</strong> > 95% (baseado em logs)</p>
                </div>
            </section>

            <section id="metricas">
                <h2>ğŸ“Š MÃ©tricas e Resultados</h2>

                <h3>AnÃ¡lise de Dados de ProduÃ§Ã£o (48 horas)</h3>
                <p><strong>PerÃ­odo:</strong> 06/02/2026 - 08/02/2026</p>

                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="number">317</div>
                        <div class="label">Mensagens Processadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">42</div>
                        <div class="label">Conversas Individuais</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">1</div>
                        <div class="label">TransferÃªncia Completa</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">0</div>
                        <div class="label">Erros CrÃ­ticos</div>
                    </div>
                </div>

                <h3>Comparativo: Atendimento Humano vs. Bot</h3>
                <table>
                    <thead>
                        <tr>
                            <th>MÃ©trica</th>
                            <th>Humano (Antes)</th>
                            <th>Bot (Agora)</th>
                            <th>Impacto</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Tempo de primeira resposta</strong></td>
                            <td>96 min (mediana)</td>
                            <td>~35 segundos</td>
                            <td style="color: #48bb78; font-weight: bold;">â–¼ 99,4%</td>
                        </tr>
                        <tr>
                            <td><strong>Disponibilidade</strong></td>
                            <td>Seg-Sex 8h-18h, SÃ¡b 8h-12h</td>
                            <td>24/7/365</td>
                            <td style="color: #48bb78; font-weight: bold;">+168h/semana</td>
                        </tr>
                        <tr>
                            <td><strong>Atendimentos simultÃ¢neos</strong></td>
                            <td>1 por vez</td>
                            <td>Ilimitado</td>
                            <td style="color: #48bb78; font-weight: bold;">âˆ</td>
                        </tr>
                        <tr>
                            <td><strong>Coleta de dados</strong></td>
                            <td>~50-60% completa</td>
                            <td>>90% completa</td>
                            <td style="color: #48bb78; font-weight: bold;">+50%</td>
                        </tr>
                        <tr>
                            <td><strong>Custo mensal (APIs)</strong></td>
                            <td>-</td>
                            <td>R$ 10-12</td>
                            <td style="color: #48bb78; font-weight: bold;">MÃ­nimo</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Comportamentos Validados em ProduÃ§Ã£o</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>âœ… Fluxo de Coleta Perfeito</h4>
                        <p><strong>Caso: Victor/Camaro</strong> - Coletou TODOS os dados (nome, veÃ­culo, ano, aro, estilo, quantidade) antes de transferir.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… Bloqueio PÃ³s-Humano</h4>
                        <p><strong>Caso: JosÃ© Domingues</strong> - Atendente assumiu, bot ficou silencioso durante toda a negociaÃ§Ã£o.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… Retomada AutomÃ¡tica</h4>
                        <p><strong>Caso: Cleyton</strong> - Block de 3h expirou (15:03+3h=18:03), bot voltou Ã s 18:31 corretamente.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… Reconhecimento Multimodal</h4>
                        <p><strong>Caso: MÃ¡rcio/Palio</strong> - Cliente enviou imagem + texto, bot reconheceu foto no contexto.</p>
                    </div>
                </div>

                <h3>Problemas Identificados e Corrigidos</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Problema</th>
                            <th>Impacto</th>
                            <th>SoluÃ§Ã£o Implementada</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Auto-reply do WhatsApp Business competindo com bot</td>
                            <td>Cliente recebe 2 mensagens iniciais</td>
                            <td>OrientaÃ§Ã£o ao cliente para desativar</td>
                        </tr>
                        <tr>
                            <td>Mensagens efÃªmeras nÃ£o tratadas</td>
                            <td>PossÃ­vel perda de mensagens</td>
                            <td>Adicionado tratamento no Switch</td>
                        </tr>
                        <tr>
                            <td>Erro ao enviar vCard/contato</td>
                            <td>Crash do workflow</td>
                            <td>Guard <code>$if(isExecuted)</code> em 4 expressÃµes</td>
                        </tr>
                        <tr>
                            <td>VÃ­deos ignorados</td>
                            <td>Cliente sem resposta</td>
                            <td>TranscriÃ§Ã£o de Ã¡udio do vÃ­deo via Whisper</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section id="tecnico">
                <h2>ğŸ”§ Detalhes TÃ©cnicos AvanÃ§ados</h2>

                <h3>1. Formato de TransferÃªncia Estruturado</h3>
                <p>Sistema proprietÃ¡rio baseado em marcador + JSON na primeira linha da resposta da IA:</p>
                <pre><code>[TRANSFER:{"name":"JosÃ©","vehicle":"Corolla 2022","service":"rodas","summary":"4 rodas aro 18 esportivo","qty":4,"urgency":"media"}]

Ã“timo, JosÃ©! Anotei tudo. Nosso especialista em rodas vai entrar em contato com vocÃª em breve com valores e disponibilidade!</code></pre>

                <h4>ExtraÃ§Ã£o e Processamento</h4>
                <p>Node JavaScript <code>Processar TransferÃªncia</code> (80 linhas):</p>
                <ul class="checklist">
                    <li>Regex multiline para extrair JSON: <code>/\[TRANSFER:(.*?)\]/s</code></li>
                    <li>Parse seguro com try/catch</li>
                    <li>ValidaÃ§Ã£o de campos obrigatÃ³rios</li>
                    <li>VerificaÃ§Ã£o de horÃ¡rio comercial (fuso SÃ£o Paulo)</li>
                    <li>FormataÃ§Ã£o de mensagens (grupo + cliente)</li>
                    <li>GeraÃ§Ã£o de deep link wa.me</li>
                </ul>

                <h3>2. Sistema de DeduplicaÃ§Ã£o por ID</h3>
                <div class="highlight-box">
                    <h4>Problema Original</h4>
                    <p>DeduplicaÃ§Ã£o por <strong>conteÃºdo da mensagem</strong> era frÃ¡gil: se cliente mandava "oi" 3 vezes, todas passavam.</p>

                    <h4>SoluÃ§Ã£o Implementada</h4>
                    <p>Uso do campo <code>id</code> Ãºnico da mensagem (WhatsApp):</p>
                    <pre><code>// Redis RPUSH
messageData: $('Dados').item.json.id + '|||' + $('Message').item.json.message

// If2 (comparaÃ§Ã£o)
leftValue: ($json.messages || []).last().split('|||')[0]
rightValue: $('Dados').item.json.id

// Mensagem final (join)
$('Redis2').item.json.messages.map(m => m.split('|||')[1]).join("\n")</code></pre>
                </div>

                <h3>3. Problema de JID Duplo (LID)</h3>
                <div class="highlight-box warning">
                    <h4>Descoberta em ProduÃ§Ã£o</h4>
                    <p>WhatsApp usa <strong>dois identificadores</strong> para o mesmo contato:</p>
                    <ul>
                        <li><code>@s.whatsapp.net</code> (JID clÃ¡ssico)</li>
                        <li><code>@lid</code> (LID, novo formato)</li>
                    </ul>
                    <p><strong>Impacto:</strong> Block setado em um JID pode nÃ£o funcionar no outro.</p>
                    <p><strong>Exemplo real:</strong> Cleyton = <code>188476418949227@lid</code> E <code>12035103554@s.whatsapp.net</code></p>
                    <p><strong>SoluÃ§Ã£o futura:</strong> NormalizaÃ§Ã£o de JID usando campo <code>remoteJidAlt</code> como canonical.</p>
                </div>

                <h3>4. Guards de ExecuÃ§Ã£o</h3>
                <p>Problema: ApÃ³s node <code>Wait</code> resumir execuÃ§Ã£o, n8n perde referÃªncia a nodes anteriores.</p>
                <p><strong>SoluÃ§Ã£o:</strong> Guard <code>$if(isExecuted)</code> em todas as referÃªncias ao node <code>Message</code>:</p>
                <pre><code>// ANTES (causava erro)
={{ $('Message').item.json.message }}

// DEPOIS (safe)
={{ $if($('Message').isExecuted, $('Message').item.json.message, '') }}</code></pre>
                <p><strong>Nodes protegidos:</strong> Chat Memory Manager, Chat Memory Manager1, Redis1, If2</p>

                <h3>5. System Prompt Otimizado</h3>
                <p>Prompt de ~2.500 tokens com:</p>
                <ul class="checklist">
                    <li><strong>Persona:</strong> "Pity", equipe de atendimento (nunca revela ser IA)</li>
                    <li><strong>Tom de voz:</strong> AmigÃ¡vel mas profissional, sem gÃ­rias exageradas</li>
                    <li><strong>Regra de ouro:</strong> NUNCA transferir antes de coletar TODOS os dados</li>
                    <li><strong>PolÃ­tica de preÃ§os:</strong> Nunca informa valores, sempre transfere ao especialista</li>
                    <li><strong>Conhecimento de produtos:</strong> Kr, Zunk, Volcano, BRW, Delinte, Goodyear, Pirelli, etc</li>
                    <li><strong>ProteÃ§Ã£o anti-injection:</strong> Ignora tentativas de alteraÃ§Ã£o de comportamento</li>
                </ul>

                <h3>6. Custos de API (Detalhado)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>API</th>
                            <th>Modelo/Tier</th>
                            <th>Custo</th>
                            <th>Uso Mensal Estimado</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Google Gemini</strong></td>
                            <td>2.0 Flash</td>
                            <td>$0.10/1M tokens input<br>$0.40/1M tokens output</td>
                            <td>~4.3M input + 0.2M output<br>= <strong>$0.51/mÃªs</strong></td>
                        </tr>
                        <tr>
                            <td><strong>Groq Whisper</strong></td>
                            <td>Large v3 Turbo</td>
                            <td>$0.04/minuto</td>
                            <td>~30 minutos/mÃªs<br>= <strong>$1.20/mÃªs</strong></td>
                        </tr>
                        <tr>
                            <td colspan="3"><strong>TOTAL MENSAL</strong></td>
                            <td><strong>~$1.71 (R$ 10-12)</strong></td>
                        </tr>
                    </tbody>
                </table>
                <p><em>Base: 326 sessÃµes/mÃªs, mÃ©dia 7.4 msgs/sessÃ£o, 10% Ã¡udio</em></p>
            </section>

            <section id="impacto">
                <h2>ğŸ’¼ Impacto de NegÃ³cio</h2>

                <h3>ROI Estimado</h3>
                <div class="stat-grid">
                    <div class="stat-card">
                        <div class="number">R$ 10-12</div>
                        <div class="label">Custo Mensal (APIs)</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">~40h</div>
                        <div class="label">Tempo de Vendedor Economizado/MÃªs</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">+30%</div>
                        <div class="label">Leads Capturados (estimativa)</div>
                    </div>
                    <div class="stat-card">
                        <div class="number">100%</div>
                        <div class="label">Leads com Dados Completos</div>
                    </div>
                </div>

                <h3>BenefÃ­cios QuantificÃ¡veis</h3>
                <table>
                    <thead>
                        <tr>
                            <th>BenefÃ­cio</th>
                            <th>Valor/Impacto</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Captura de leads fora do horÃ¡rio (antes perdidos)</td>
                            <td>+20-30 leads/mÃªs (estimativa)</td>
                        </tr>
                        <tr>
                            <td>Tempo do vendedor focado em negociaÃ§Ã£o</td>
                            <td>~40h/mÃªs recuperadas</td>
                        </tr>
                        <tr>
                            <td>ReduÃ§Ã£o de tempo de resposta</td>
                            <td>De 96 min â†’ 35s (99.4%)</td>
                        </tr>
                        <tr>
                            <td>Taxa de leads com dados completos</td>
                            <td>De ~50% â†’ >90%</td>
                        </tr>
                        <tr>
                            <td>Custo por lead qualificado</td>
                            <td>R$ 0,03 (vs. horas de salÃ¡rio)</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Escalabilidade</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Volume Mensal</th>
                            <th>Custo API</th>
                            <th>Custo por Lead</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>326 sessÃµes (atual)</td>
                            <td>R$ 10-12</td>
                            <td>R$ 0,03</td>
                        </tr>
                        <tr>
                            <td>652 sessÃµes (2x)</td>
                            <td>R$ 20-24</td>
                            <td>R$ 0,03</td>
                        </tr>
                        <tr>
                            <td>1.630 sessÃµes (5x)</td>
                            <td>R$ 50-60</td>
                            <td>R$ 0,03</td>
                        </tr>
                        <tr>
                            <td>3.260 sessÃµes (10x)</td>
                            <td>R$ 100-120</td>
                            <td>R$ 0,03</td>
                        </tr>
                    </tbody>
                </table>
                <p><em>Custo escala linearmente, sem degradaÃ§Ã£o de performance atÃ© 10x o volume atual.</em></p>

                <h3>Diferenciais Competitivos</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ§  IA Conversacional Real</h4>
                        <p>Gemini 2.0, nÃ£o Ã¡rvore de decisÃ£o como concorrentes.</p>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ™ï¸ TranscriÃ§Ã£o de Ãudio/VÃ­deo</h4>
                        <p>Raro em soluÃ§Ãµes de mercado.</p>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ“„ ExtraÃ§Ã£o de PDF</h4>
                        <p>Cliente pode enviar orÃ§amento de concorrente.</p>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ”„ Handoff IA â†” Humano</h4>
                        <p>Bloqueio inteligente com retomada automÃ¡tica.</p>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ  Self-hosted</h4>
                        <p>Dados no servidor do cliente, nÃ£o em SaaS terceiro.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âš™ï¸ PersonalizaÃ§Ã£o Total</h4>
                        <p>Prompt, fluxo e comportamento 100% customizÃ¡veis.</p>
                    </div>
                </div>
            </section>

            <section id="conclusao">
                <h2>ğŸ¯ ConclusÃ£o</h2>

                <p>Este projeto demonstra capacidade tÃ©cnica para:</p>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>âœ… Arquitetura de Sistemas Complexos</h4>
                        <p>IntegraÃ§Ã£o de 5 tecnologias (n8n, Evolution API, Gemini, Groq, Redis) com 37 nodes orquestrados.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… Engenharia de Prompts</h4>
                        <p>System prompt de 2.500 tokens com proteÃ§Ãµes anti-injection e coleta estruturada de dados.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… ResiliÃªncia e Tratamento de Erros</h4>
                        <p>Retry em 100% das APIs externas, fallbacks graciosos, guards de execuÃ§Ã£o.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… DecisÃµes Baseadas em Dados</h4>
                        <p>Wait de 30s, block de 3h, TTL de 24h - tudo calibrado com dados reais de produÃ§Ã£o.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… Processamento Multimodal</h4>
                        <p>Texto, Ã¡udio, vÃ­deo, imagem, PDF, localizaÃ§Ã£o - 8 tipos de mensagem tratados.</p>
                    </div>
                    <div class="feature-card">
                        <h4>âœ… Entrega de Valor MensurÃ¡vel</h4>
                        <p>ReduÃ§Ã£o de 99.4% no tempo de resposta, disponibilidade 24/7, custo de R$ 0,03/lead.</p>
                    </div>
                </div>

                <div class="highlight-box success" style="margin-top: 30px;">
                    <h4>ğŸš€ Resultado Final</h4>
                    <p>Sistema em <strong>produÃ§Ã£o estÃ¡vel</strong> desde 06/02/2026, processando mensagens reais com 0 erros crÃ­ticos em 48 horas de operaÃ§Ã£o monitorada. O bot funciona como primeiro ponto de contato, coletando dados estruturados e transferindo leads qualificados para vendedores, permitindo que equipe humana foque 100% em negociaÃ§Ã£o e fechamento.</p>
                </div>

                <h3 style="margin-top: 40px;">Tecnologias Dominadas</h3>
                <div style="margin: 20px 0;">
                    <span class="badge tech">n8n</span>
                    <span class="badge tech">Evolution API</span>
                    <span class="badge tech">Google Gemini</span>
                    <span class="badge tech">Groq Whisper</span>
                    <span class="badge tech">Redis</span>
                    <span class="badge tech">Webhook Integration</span>
                    <span class="badge tech">LLM Prompt Engineering</span>
                    <span class="badge tech">WhatsApp Business API</span>
                    <span class="badge tech">Speech-to-Text</span>
                    <span class="badge tech">PDF Extraction</span>
                    <span class="badge tech">Error Handling & Retry</span>
                    <span class="badge tech">Session Management</span>
                    <span class="badge tech">Data-driven Decision Making</span>
                </div>
            </section>
        </div>

        <footer>
            <p><strong>Chatbot WhatsApp com IA - Pity Rodas</strong></p>
            <p>DocumentaÃ§Ã£o TÃ©cnica Completa | Desenvolvido por Victor Sam</p>
            <p style="margin-top: 10px; opacity: 0.8;">Fevereiro 2026 | Sistema em ProduÃ§Ã£o</p>
        </footer>
    </div>
</body>
</html>